.include "../cheridefs.mk"

CFLAGS+=-DZLIB_INCL_WRAPPER

CFLAGS+=$(OPTCFLAGS)

zwrapper1.o:
		$(CC) $(CFLAGS) -DLZ_SINGLE_SANDBOX -c zwrapper.c -o zwrapper1.o

zwrapperm.o:
		$(CC) $(CFLAGS) -c zwrapper.c -o zwrapperm.o

all: zwrapper1.o zwrapperm.o
	mkdir -p tmpdir
	cd tmpdir && \
	$(AR) -x ../../libcheri_u/libcheri.a && \
	cd ..
	$(AR) -r libzwrapper1.a zwrapper1.o tmpdir/*.o
	$(AR) -r libzwrapperm.a zwrapperm.o tmpdir/*.o

clean:
	rm -f *.a *.so *.o *.so.1
	rm -rf tmpdir

